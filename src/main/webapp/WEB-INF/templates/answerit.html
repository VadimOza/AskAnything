<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>AskAnything</title>
    <meta th:name="_csrf" th:content="${_csrf.token}"/>
    <meta th:name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" type="text/css" href="/resources/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="/resources/css/adaptive.css"/>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700,300' rel='stylesheet'
          type='text/css'/>
    <meta charset="utf-8"/>
    <link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet"/>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
<header>
    <div class="navbar">
        <div class="menu">
            <div class="header_logo">
                <a href="/"><img class="logo" src="/resources/css/img/logo.png"/></a>
            </div>
            <section class="header_info">
                <div class="logout">
                    <a href="/logout"><img src="/resources/css/img/logout.png"/></a>
                    <div class="textreg"><a href="#"><span>Выход</span></a></div>
                </div>
            </section>
        </div>
    </div>
</header>
<main>
    <div class="useranswer">
        <form method="post" th:each="qest  : ${questions}" id="lolik">
            <p><span th:text="${qest.user.username}">Vadim:</span><span th:name="question"
                                                                        th:text="${qest.question}"></span></p>
            <!--<input type="text" name="question" th:value="${qest.question}"  disabled="true">Some question ????</input>-->
            <!--<input type="text" name="question" th:value="${qest.question}">Some question ????</input>-->
            <textarea name="answer" placeholder="Type your answer here..."></textarea>
            <span th:text="${qest.date}"></span>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="button" value="Answer" id="answerAll" onclick="answerIt(this)"/>
        </form>
    </div>
</main>
<div class="footer">
    <div class="copyright">©Копирайт бай Вадимка</div>
</div>
<script>
    var httpRequest;
    var formToHide;

    function answerIt(button) {
        formToHide = button.parentElement;
        var question = button.parentElement.childNodes[1].childNodes[1].innerHTML;
        var answer = button.parentElement.childNodes[7].value;
        var date = button.parentElement.childNodes[9].innerHTML;

        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        httpRequest = new XMLHttpRequest();

        if (!httpRequest) {
            alert("Giving up :( Cannot create an XMLHTTP instance!");
            return false;
        }
        httpRequest.onreadystatechange = alertContents;
        httpRequest.open('POST', "/user/asynkAnswers");
        httpRequest.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        httpRequest.setRequestHeader(header, token);
        httpRequest.send(JSON.stringify({'question': question, 'answer': answer, 'date': date}));

    }

    function alertContents() {
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
            if (httpRequest.status === 200) {
                alert(httpRequest.responseText);
                formToHide.style.display = 'none';
            } else {
                alert('There was a problem with the request.' + httpRequest.status);
            }
        }
    }


</script>
</body>
</html>